FROM ubuntu:20.10

ARG PROFILE=release

COPY target/${PROFILE}/btc-parachain /usr/local/bin
COPY polkabtc-rococo.json /var/lib

# Checks
RUN chmod +x /usr/local/bin/btc-parachain && \
    ldd /usr/local/bin/btc-parachain && \
    /usr/local/bin/btc-parachain --version

RUN /usr/local/bin/btc-parachain export-genesis-state --chain /var/lib/polkabtc-rococo.json > /var/lib/genesis-state
RUN /usr/local/bin/btc-parachain export-genesis-wasm --chain /var/lib/polkabtc-rococo.json > /var/lib/genesis-wasm

EXPOSE 30333 9933 9944
VOLUME ["/data"]

CMD ["/usr/local/bin/btc-parachain"]
